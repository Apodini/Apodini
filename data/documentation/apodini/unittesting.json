{"seeAlsoSections":[{"title":"Basics","identifiers":["doc:\/\/Apodini\/documentation\/Apodini\/BuildingBlocks","doc:\/\/Apodini\/documentation\/Apodini\/Metadata","doc:\/\/Apodini\/documentation\/Apodini\/AllAboutReuse","doc:\/\/Apodini\/documentation\/Apodini\/CommandLineArguments","doc:\/\/Apodini\/documentation\/Apodini\/StatefulHandlers","doc:\/\/Apodini\/documentation\/Apodini\/InformationAPI"],"generated":true}],"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","level":2,"type":"heading","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The following example shows you a typical test class used to cite unit test for an Apodini web service. We subclass from "},{"type":"codeVoice","code":"XCTApdiniTest"},{"type":"text","text":" or "},{"type":"codeVoice","code":"XCTApodiniDatabaseTest"},{"type":"text","text":" to already get access to an Apodini app instance in the unit tests and get convenience methods to access the database and add migrations "},{"type":"codeVoice","code":".addMigrations()"},{"type":"text","text":" for "},{"type":"codeVoice","code":"XCTApodiniDatabaseTest"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The code snippets shown in this article are based on the Apodini example project in the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/DatabaseConnection"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"In line 8 we define a @PathParameter that showcases how you can define different parameters that can be passed to Handlers or Components in the test cases."}]},{"type":"codeListing","syntax":"swift","code":["@testable import ExampleWebService","import Shared","import XCTApodini","import XCTApodiniDatabase"," ","final class ContactHandlerTests: XCTApodiniDatabaseTest {","    @PathParameter var contactId: Contact.IDValue","     ","    override func setUpWithError() throws {","        try super.setUpWithError()","         ","        try addMigrations(","            ContactMigration(),","            ResidenceMigration()","        )","    }  "]},{"anchor":"XCTCheckHandler","level":3,"type":"heading","text":"XCTCheckHandler"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"XCTCheckHandler(handler:,mocks:,):"},{"type":"text","text":" can be used to test a single Handler."},{"type":"text","text":" "},{"type":"text","text":"The result builder expects one or more elements conforming to "},{"type":"codeVoice","code":"Mock"},{"type":"text","text":" like:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"MockRequest"},{"type":"text","text":" to send mock requests to a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Handler"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"MockObservedListener"},{"type":"text","text":" to test observables, e.g. if they are triggered by requests"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"ExecuteClosure"},{"type":"text","text":" to manually execute code between any other "},{"type":"codeVoice","code":"Mock"},{"type":"text","text":"s"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"A "},{"type":"codeVoice","code":"MockRequest"},{"type":"text","text":" can have different expectations or assertions defined that test the output of the mock request."}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"In the first test we initialize the contact emma (Line 32) with attributes name and birthday and use the assertion closure that gets passed in the realist of the Handler invocation to test if the contact is displayed correctly using the "},{"type":"codeVoice","code":"XCTAssertEqual()"},{"type":"text","text":" function."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"MockRequest"},{"type":"text","text":" can also check based on using the build in equatable functionality of the response is the expected outcome. Using "},{"type":"codeVoice","code":"MockRequest(expectation:)"},{"type":"text","text":" you can direly pass in the expected result or a combination of the expected result, expected status code, and connection state after the "},{"type":"codeVoice","code":"MockRequest"},{"type":"text","text":". (Line 49)"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"A "},{"type":"codeVoice","code":"MockRequest"},{"type":"text","text":" offers the possibility to pass parameters to the "},{"type":"codeVoice","code":"Handler"},{"type":"text","text":"."}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"UnnamedParameter(_:):"},{"type":"text","text":" Defines an unnamed parameter (e.g. as part of the URL path) that is passed to the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Handler"},{"type":"text","text":" and matched based on comparing the possible "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Parameter"},{"type":"text","text":" types and types of passed in "},{"type":"codeVoice","code":"UnnammedParameter"},{"type":"text","text":"."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"NamedParameter(_:, value:):"},{"type":"text","text":" Defines an named parameter that is passed to the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Handler"},{"type":"text","text":" and matched based on comparing the possible "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Parameter"},{"type":"text","text":" names and types of passed in `NamedParameters."}]}]}]},{"type":"codeListing","syntax":"swift","code":["func testCreateContact() throws {","    let emma = Contact(name: \"Emma Stone\", birthday: Date(timeIntervalSince1970: 594777600))","     ","    try XCTCheckHandler(CreateContact()) {","        MockRequest(assertion: { (returnedContact: Contact) in","            XCTAssertEqual(returnedContact.name, emma.name)","            XCTAssertEqual(returnedContact.birthday, emma.birthday)","        }) {","            NamedParameter(\"contact\", value: emma)","        }","    }","}","","func testGetContacts() throws {","    let emma = Contact(name: \"Emma Stone\", birthday: Date(timeIntervalSince1970: 594777600))","    try emma.save(on: app.database).wait()","     ","    try XCTCheckHandler(GetContacts()) {","        MockRequest(expectation: [emma])"]},{"anchor":"MockRequest-Options","level":3,"type":"heading","text":"MockRequest Options"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Apodini supports Web APIs that keep connections between different subsequent requests open, e.g. WebSockets and gRPC. Therefore the default behaviour is to keep the connections open between two dsubsequent "},{"type":"codeVoice","code":"MockRequest"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"By default open connections reuse all available parameters from the previous request and reuse them for the next request. In contrast to request protocol specific exporters this can lead to unexpected behaviour in test cases that to not include a sophisticated logic to reduce parameters (UnnamedParameters are just aggregated, NamedParameter are overwritten if they have the same name)."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Therefore "},{"type":"codeVoice","code":"XCTApodini"},{"type":"text","text":" includes options for each "},{"type":"codeVoice","code":"MockRequest"},{"type":"text","text":":"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"subsequentRequest"},{"type":"text","text":": The default option. Reduces parameters: ("},{"type":"codeVoice","code":"UnnamedParameters"},{"type":"text","text":" are just aggregated, "},{"type":"codeVoice","code":"NamedParameter"},{"type":"text","text":" are overwritten if they have the same name)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"doNotReduceRequest"},{"type":"text","text":": Does keep the connection context around (e.g. the connection stays open between requests) but does not reduce the parameters"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"doNotReuseConnection"},{"type":"text","text":": Creates a new connection context for the `MockRequest."}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"To simulate a REST request we do not reuse the connection context for subsequent requests here:"}]},{"type":"codeListing","syntax":"swift","code":["func testGreeeterWithParameter() throws {","    let emma = Contact(name: \"Emma Stone\", birthday: Date(timeIntervalSince1970: 594777600))","    try emma.save(on: app.database).wait()","    let ryan = Contact(name: \"Ryan Reynolds\", birthday: Date(timeIntervalSince1970: 214876800))","    try ryan.save(on: app.database).wait()","     ","    try XCTCheckHandler(GetContact(contactId: $contactId)) {","        MockRequest(expectation: emma) {","            UnnamedParameter(emma.id)","        }","        MockRequest(expectation: ryan, options: .doNotReuseConnection) {","            UnnamedParameter(ryan.id)","        }","    }","}  "]},{"anchor":"XCTCheckComponent","level":3,"type":"heading","text":"XCTCheckComponent"},{"type":"paragraph","inlineContent":[{"type":"text","text":"You can also test "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Component"},{"type":"text","text":"s using "},{"type":"codeVoice","code":"XCTApodini"},{"type":"text","text":". Using "},{"type":"codeVoice","code":"XCTCheckComponent"},{"type":"text","text":" you pass in a complete "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Component"},{"type":"text","text":" and using "},{"type":"codeVoice","code":"CheckHandler"},{"type":"text","text":" you identify which "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Handler"},{"type":"text","text":" you want to use."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"We currently envision three ways to identify "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Handler"},{"type":"text","text":":"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"index: Identify a "},{"type":"codeVoice","code":"Handler"},{"type":"text","text":" using the index it is parsed when traversing the "},{"type":"codeVoice","code":"Component"},{"type":"text","text":" (Currently implemented)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"path: Identify a "},{"type":"codeVoice","code":"Handler"},{"type":"text","text":" using the path it is located at as defined when parsing the Apodini DSL (Currently not implemented)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"identifier: Identify a "},{"type":"codeVoice","code":"Handler"},{"type":"text","text":" using the unique identifier assigned by Apodini when parsing the Apodini DSL (Currently not implemented)"},{"type":"text","text":" "},{"type":"text","text":"Exactly like "},{"type":"codeVoice","code":"XCTCheckHandler"},{"type":"text","text":" the "},{"type":"codeVoice","code":"CheckHandler"},{"type":"text","text":" result builder expects one or more Mocks to test the identified "},{"type":"codeVoice","code":"Handler"},{"type":"text","text":"."}]}]}]},{"type":"codeListing","syntax":"swift","code":["func testGreeterComponentWithParameter() throws {","     try XCTCheckComponent(GreeterComponent()) {","         CheckHandler<Greeter>(index: 0) {","             MockRequest(expectation: Name(name: \"Hello Paul 👋\")) {","                 UnnamedParameter(\"Paul\")","             }","         }","     }"," }"]}]}],"variants":[{"paths":["\/documentation\/apodini\/unittesting"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/Apodini\/documentation\/Apodini\/UnitTesting","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"Show how to create a typical test class for an Apodini web service."}],"kind":"article","metadata":{"modules":[{"name":"Apodini"}],"role":"collectionGroup","title":"Unit Testing in Apodini"},"hierarchy":{"paths":[["doc:\/\/Apodini\/documentation\/Apodini"]]},"topicSections":[{"title":"Testing","identifiers":["doc:\/\/Apodini\/documentation\/Apodini\/NegativeCompileTest"]}],"references":{"doc://Apodini/documentation/Apodini/NegativeCompileTest":{"role":"collectionGroup","title":"Negative Compile Test","abstract":[{"type":"text","text":"Defining new test target to verify certain expressions in a compile time error."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/NegativeCompileTest","kind":"article","type":"topic","url":"\/documentation\/apodini\/negativecompiletest"},"doc://Apodini/documentation/Apodini":{"role":"collection","title":"Apodini","abstract":[{"type":"text","text":"A declarative, composable framework to build web services using Swift."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini","kind":"symbol","type":"topic","url":"\/documentation\/apodini"},"doc://Apodini/documentation/Apodini/BuildingBlocks":{"role":"collectionGroup","title":"Apodini’s Building Blocks","abstract":[{"type":"text","text":"This chapter introduces you to the most important building blocks of an Apodini web service."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/BuildingBlocks","kind":"article","type":"topic","url":"\/documentation\/apodini\/buildingblocks"},"doc://Apodini/documentation/Apodini/Handler":{"role":"symbol","title":"Handler","fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"kind":"identifier","text":"Handler"}],"abstract":[{"type":"text","text":"A "},{"type":"codeVoice","code":"Handler"},{"type":"text","text":" is a "},{"type":"codeVoice","code":"Component"},{"type":"text","text":" which defines an endpoint and can handle requests."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Handler","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"Handler"}],"url":"\/documentation\/apodini\/handler"},"doc://Apodini/documentation/Apodini/DatabaseConnection":{"role":"collectionGroup","title":"Database Connection","abstract":[{"type":"text","text":"Connect Apodini project to a database system."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/DatabaseConnection","kind":"article","type":"topic","url":"\/documentation\/apodini\/databaseconnection"},"doc://Apodini/documentation/Apodini/Component":{"role":"symbol","title":"Component","fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"kind":"identifier","text":"Component"}],"abstract":[{"type":"text","text":"A "},{"type":"codeVoice","code":"Component"},{"type":"text","text":" is the central building block of  Apodini. Each component handles a specific functionality of the Apodini web service."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Component","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"Component"}],"url":"\/documentation\/apodini\/component"},"doc://Apodini/documentation/Apodini/Metadata":{"role":"collectionGroup","title":"Metadata","abstract":[{"type":"text","text":"Map requirements of your web service into the implementation."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Metadata","kind":"article","type":"topic","url":"\/documentation\/apodini\/metadata"},"doc://Apodini/documentation/Apodini/StatefulHandlers":{"role":"collectionGroup","title":"Stateful Handlers","abstract":[{"type":"text","text":"Usually endpoints only handle one request and answer with one response. However, in certain cases, this is not enough. Apodini sets no restrictions on this."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/StatefulHandlers","kind":"article","type":"topic","url":"\/documentation\/apodini\/statefulhandlers"},"doc://Apodini/documentation/Apodini/AllAboutReuse":{"role":"collectionGroup","title":"All About Reuse","abstract":[{"type":"text","text":"Despite its declarative nature, Apodini’s API is really flexible and enables you to build reusable components on many different levels."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/AllAboutReuse","kind":"article","type":"topic","url":"\/documentation\/apodini\/allaboutreuse"},"doc://Apodini/documentation/Apodini/Parameter":{"role":"symbol","title":"Parameter","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"Parameter"}],"abstract":[{"type":"text","text":"The "},{"type":"codeVoice","code":"@Parameter"},{"type":"text","text":" property wrapper can be used to express input in "},{"type":"codeVoice","code":"Components"}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/Parameter","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"Parameter"}],"url":"\/documentation\/apodini\/parameter"},"doc://Apodini/documentation/Apodini/InformationAPI":{"role":"collectionGroup","title":"Information","abstract":[{"type":"text","text":"The Information API maps middleware-specific metadata of the respective wire protocol into the framework"},{"type":"text","text":" "},{"type":"text","text":"making it accessible inside a Handler."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/InformationAPI","kind":"article","type":"topic","url":"\/documentation\/apodini\/informationapi"},"doc://Apodini/documentation/Apodini/CommandLineArguments":{"role":"collectionGroup","title":"Command Line Arguments Parsing","abstract":[{"type":"text","text":"Parse Command Line Arguments in an Apodini web service to dynamically adapt the configuration of the web service."}],"identifier":"doc:\/\/Apodini\/documentation\/Apodini\/CommandLineArguments","kind":"article","type":"topic","url":"\/documentation\/apodini\/commandlinearguments"}}}